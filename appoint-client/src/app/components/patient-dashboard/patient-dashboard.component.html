<div class="dashboard-container">
  <!-- Top Toolbar -->
  <header class="toolbar">
    <span>Patient Dashboard</span>
    <span class="spacer"></span>
    
    <!-- Notification Bell -->
    <div class="notification-wrapper">
      <button class="notification-bell" (click)="toggleNotifications()">
        ðŸ””
        <span *ngIf="notificationCount > 0" class="badge">{{ notificationCount }}</span>
      </button>
      
      <!-- Dropdown -->
      <div *ngIf="showNotifications" class="notification-dropdown">
        <div class="dropdown-header">
          <span *ngIf="notificationCount > 0">{{ notificationCount }} New Notification{{ notificationCount > 1 ? 's' : '' }}</span>
          <span *ngIf="notificationCount === 0">No New Notifications</span>
        </div>
        <div *ngIf="notifications.length === 0" class="no-notifications">
          All caught up! ðŸŽ‰
        </div>
        <div *ngFor="let notif of notifications" 
             class="notification-item"
             (click)="openNotificationModal(notif)">
          <div class="notif-title">{{ notif.title }}</div>
          <div class="notif-preview">{{ notif.message }}</div>
          <div class="notif-time">{{ notif.createdAt | date:'short' }}</div>
        </div>
      </div>
    </div>
    
    <span>Welcome, {{ userName }}</span>
    <button class="btn btn-secondary" (click)="logout()">Logout</button>
  </header>

  <!-- Calendar (REMOVED instructions-card) -->
  <div class="calendar-wrapper">
    <full-calendar [options]="calendarOptions"></full-calendar>
  </div>
</div>

<!-- Time Selection Modal -->
<div *ngIf="showTimeModal" class="modal" (click)="closeModal()">
  <div class="modal-content" (click)="$event.stopPropagation()">
    <h2>Select Appointment Time</h2>
    <div class="modal-body">
      <p><strong>Date:</strong> {{ selectedDate }}</p>

      <div class="form-field full-width">
        <label for="startTime">Start Time</label>
        <input type="time" id="startTime" [(ngModel)]="startTime" required>
      </div>

      <div class="form-field full-width">
        <label for="endTime">End Time</label>
        <input type="time" id="endTime" [(ngModel)]="endTime" required>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-secondary" (click)="closeModal()">Cancel</button>
      <button class="btn btn-primary" [disabled]="!startTime || !endTime" (click)="submitRequest()">
        Submit Request
      </button>
    </div>
  </div>
</div>

<!-- Notification Detail Modal -->
<div *ngIf="selectedNotification" class="modal" (click)="closeNotificationModal()">
  <div class="modal-content notification-modal" (click)="$event.stopPropagation()">
    <h2>{{ selectedNotification.title }}</h2>
    <div class="modal-body">
      <p class="notification-message">{{ selectedNotification.message }}</p>
      
      <div class="appointment-details">
        <p *ngIf="selectedNotification.doctorName">
          <strong>Doctor:</strong> {{ selectedNotification.doctorName }}
        </p>
        <p *ngIf="selectedNotification.patientName">
          <strong>Patient:</strong> {{ selectedNotification.patientName }}
        </p>
        <p>
          <strong>Date:</strong> {{ selectedNotification.appointmentDate | date:'fullDate' }}
        </p>
        <p>
          <strong>Time:</strong> {{ selectedNotification.appointmentStartTime | timeFormat }} - {{ selectedNotification.appointmentEndTime | timeFormat }}
        </p>
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn btn-primary" (click)="dismissNotification()">
        OK
      </button>
    </div>
  </div>
</div>

<!-- Alert Modal -->
<app-alert-modal
  *ngIf="showAlert"
  [title]="alertTitle"
  [message]="alertMessage"
  [type]="alertType"
  (closed)="closeAlert()">
</app-alert-modal>